import scipy,random, pickle
import sympy
from sympy import cos, sin, nsolve, Symbol
import numpy as np
import matplotlib.pyplot as plt
from matplotlib import colors
from matplotlib.ticker import PercentFormatter

from scipy.optimize import fsolve
e = 1.602*10**(-19)
address1 ="/data/runzezhang/result/SRIM_MC/MC_20231018_5582"
address2 ="/data/runzezhang/result/SRIM_MC/MC_20231018_4745"
address3 ="/data/runzezhang/result/SRIM_MC/MC_20231018_3700"
weight1 = 10.8
weight2 = 51.25
weight3 = 9.11
address_list = [address1,address2,address3]
weight_list = [weight1, weight2, weight3]


def data_pick(address):
    with open(address, "rb") as fp:  # Unpickling
        b = pickle.load(fp)

    return b

def plot_chains():
    raw_data = []
    bin_n = 500
    raw_data_ev = []
    data_buffer = []
    for address in address_list:
        raw_data.append(data_pick(address))
    # raw data is a data list
    #change data value from J into eV
    for data in raw_data:
        for data_ele in data[:500]:
            data_buffer.append(round(data_ele/e,3))
            print(round(data_ele/e,3))
        raw_data_ev.append(data_buffer)
        print("finish one run")
    print(raw_data_ev[0])
    print(address_list[0][-4:])
    print("min and max", min(raw_data_ev[0]), max(raw_data_ev[0]))
    plt.hist(raw_data_ev[0][:100], bins=50, range=(min(raw_data_ev[0]),max(raw_data_ev[0])),label=address_list[0][-4:])

    # for i in range(len(raw_data_ev)):
    #     print(len(raw_data_ev))
    #     plt.hist(raw_data_ev[i],bins= bin_n,label=address_list[i][-5:])
    plt.legend()
    plt.xlabel("energy/eV")
    plt.ylabel("N/bin")
    plt.show()

def plot_chain_sum():
    raw_data = []
    bin_n = 500
    raw_data_ev = []
    consistant_data = []
    consistant_weight =[]
    for address in address_list:
        raw_data.append(data_pick(address))
    # raw data is a data list
    # change data value from J into eV
    for i in range(len(raw_data)):
        for j in range(len(raw_data[i])):
            # add eV energy to a 1D list
            #together with its weights
            consistant_data.append(raw_data[i][j]/e)
            consistant_weight.append(weight_list[i])
    plt.hist(consistant_data,bins = bin_n, density = True, weight = consistant_weight)
    plt.xlabel("energy/eV")
    plt.ylabel("P")
    plt.show()

if __name__ =="__main__":

    test = [421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 421.680, 349.384, 250.466, 344.669, 372.724, 292.744, 375.115, 354.853, 202.596, 402.481, 381.075, 341.884, 220.716, 363.890, 438.101, 227.664, 225.766, 357.476, 415.786, 435.569, 331.889, 205.513, 438.212, 358.329, 448.796, 425.214, 256.071, 260.410, 191.490, 334.408, 297.564, 285.376, 315.460, 374.253, 286.300, 202.892, 314.081, 279.520, 293.702, 396.119, 211.423, 224.996, 389.963, 350.757, 342.336, 443.812, 358.478, 426.735, 414.186, 304.189, 314.454, 395.288, 314.547, 224.016, 385.137, 332.674, 295.557, 221.439, 333.214, 336.881, 378.949, 420.584, 229.777, 351.861, 307.749, 208.663, 346.261, 231.068, 436.160, 392.120, 267.099, 310.399, 286.228, 254.936, 303.654, 414.719, 278.557, 266.454, 391.901, 414.614, 365.082, 431.204, 316.759, 419.975, 304.100, 250.896, 396.505, 310.156, 439.377, 422.506, 224.653, 425.925, 255.145, 358.452, 269.517, 437.997, 220.325, 414.800, 233.978, 192.066, 267.368, 377.205, 438.941, 236.804, 240.722, 207.413, 302.670, 325.517, 351.523, 227.213, 405.239, 235.622, 205.736, 273.869, 242.861, 303.284, 301.442, 359.716, 276.840, 359.263, 219.285, 430.991, 212.087, 418.662, 246.403, 417.779, 198.224, 256.950, 248.394, 385.419, 364.159, 438.225, 389.546, 406.939, 426.588, 203.568, 223.439, 230.636, 235.655, 411.809, 279.656, 251.329, 437.458, 448.775, 415.124, 420.380, 219.854, 283.745, 389.870, 203.675, 312.017, 328.531, 350.565, 304.629, 369.981, 229.317, 251.097, 210.182, 224.393, 280.237, 211.991, 357.791, 449.452, 307.339, 278.417, 432.038, 412.866, 421.651, 205.393, 289.891, 207.952, 204.784, 313.847, 419.203, 222.637, 393.355, 385.141, 356.987, 345.993, 375.583, 407.646, 398.505, 301.124, 434.995, 434.361, 259.697, 259.455, 204.459, 263.249, 449.025, 319.389, 329.230, 250.101, 294.573, 201.904, 305.568, 232.622, 223.378, 222.703, 417.545, 290.749, 446.616, 348.103, 298.406, 264.987, 382.912, 379.786, 205.652, 256.320, 194.884, 423.036, 323.471, 375.230, 406.082, 381.525, 218.870, 425.478, 335.684, 236.769, 334.628, 404.942, 431.986, 296.246, 382.139, 251.419, 407.182, 278.305, 364.898, 218.944, 258.973, 344.177, 405.598, 312.356, 297.657, 249.543, 335.169, 200.134, 443.000000000000, 417.380, 349.009, 341.070, 247.240, 265.656, 236.229, 223.141, 380.710, 309.347, 334.331, 257.015, 216.280, 233.996, 223.050, 306.398, 260.540, 221.881, 198.756, 363.558, 203.648, 389.537, 416.661, 416.334, 230.460, 376.362, 258.371, 284.458, 316.864, 439.374, 310.611, 415.486, 396.090, 221.330, 288.020, 450.634, 356.053, 191.656, 400.978, 309.715, 433.075, 221.526, 237.055, 208.374, 232.222, 412.831, 267.523, 193.936, 371.214, 206.208, 197.440, 443.653, 273.092, 196.018, 397.378, 352.996, 428.481, 345.056, 445.951, 389.519, 395.386, 278.858, 337.845, 331.532, 345.652, 330.990, 281.382, 383.465, 304.781, 377.820, 266.330, 208.204, 406.765, 216.460, 333.821, 442.678, 416.039, 248.506, 363.725, 296.672, 362.348, 430.698, 397.221, 360.693, 332.615, 382.165, 310.229, 275.625, 289.465, 267.896, 431.962, 333.732, 263.244, 289.596, 361.994, 306.548, 353.392, 387.092, 315.137, 384.632, 415.138, 435.079, 400.794, 386.274, 403.768, 229.915, 294.337, 238.923, 376.976, 410.459, 193.015, 397.444, 231.859, 253.973, 370.450, 191.390, 322.978, 426.802, 235.529, 376.032, 389.145, 306.494, 205.973, 223.604, 353.504, 291.837, 434.469, 331.311, 355.294, 217.348, 415.788, 231.807, 300.055, 440.890, 274.394, 339.812, 276.814, 393.939, 420.818, 271.669, 268.153, 370.019, 251.758, 323.740, 309.903, 438.055, 402.751, 365.294, 360.258, 439.869, 200.330, 261.929, 366.567, 239.213, 262.501, 252.155, 215.748, 303.001, 200.539, 230.484, 221.777, 199.355, 285.514, 329.288, 262.414, 351.532, 343.628, 396.832, 442.160, 232.906, 241.064, 374.880, 365.976, 448.223, 211.775, 432.266, 249.855, 195.176, 216.618, 354.154, 339.599, 348.597, 233.610, 283.433, 407.807, 200.449, 411.657, 387.927, 252.690, 331.570, 355.041, 415.652, 213.101, 234.933, 300.911, 413.835, 412.049, 353.803, 449.454, 253.116, 389.200, 316.307, 201.568, 320.336, 279.614, 414.870, 408.416, 410.395, 449.685, 308.733, 371.787, 349.889, 432.518, 266.001, 363.688, 205.947, 290.675, 209.117, 255.586, 377.965, 445.650, 192.746, 220.754, 415.480, 391.562, 307.299, 315.560, 444.067, 400.544, 350.811, 209.282, 235.324, 228.420, 408.136, 433.817, 342.296, 444.760, 371.772, 300.005, 420.544, 278.903, 301.487, 285.115, 281.514, 335.416, 191.337, 372.420, 299.978, 371.261, 371.954, 264.229, 358.124, 432.192, 335.071, 366.676, 396.333, 357.753, 247.400, 213.852, 405.942, 405.317, 368.197, 284.810, 445.190, 209.974, 149.595, 175.372, 150.111, 226.859, 226.731, 309.760, 100.553, 212.616, 355.400, 243.393, 103.323, 340.775, 183.601, 217.884, 107.536, 351.465, 365.739, 392.734, 320.746, 108.184, 401.911, 304.845, 300.333, 201.847, 215.099, 222.244, 177.746, 324.401, 170.310, 245.284, 162.381, 211.859, 246.259, 93.046, 245.823, 126.057, 178.245, 261.626, 102.031, 112.714, 175.746, 331.539, 278.401, 255.922, 343.795, 401.938, 192.554, 279.845, 191.751, 356.713, 151.532, 118.903, 197.456, 179.569, 140.319, 87.830, 150.817, 321.058, 276.214, 248.142, 206.499, 253.438, 117.704, 132.527, 290.569, 159.935, 205.049, 343.773, 193.435, 130.458, 113.145, 215.037, 208.804, 263.268, 201.328, 234.939, 381.456, 285.935, 331.317, 390.637, 184.080, 398.061, 110.659, 133.236, 368.630, 245.273, 326.799, 348.099, 74.916, 207.856, 93.312, 299.475, 134.275, 427.661, 76.561, 305.632, 202.509, 175.794, 216.710, 278.319, 203.531, 201.429, 106.708, 163.473, 113.167, 322.338, 141.021, 175.336, 229.847, 197.544, 186.952, 205.739, 207.709, 287.585, 197.731, 215.466, 232.660, 211.001, 79.099, 421.076, 172.196, 367.991, 78.533, 405.913, 88.784, 89.152, 163.189, 316.556, 255.047, 231.817, 284.821, 254.787, 393.401, 84.296, 69.248, 199.001, 232.607, 184.039, 176.371, 129.984, 186.990, 343.961, 367.176, 411.326, 185.777, 243.225, 287.487, 185.905, 175.673, 269.934, 326.121, 110.994, 314.971, 89.582, 217.449, 103.421, 134.969, 98.415, 159.381, 244.792, 191.981, 136.784, 199.408, 399.309, 210.575, 225.290, 129.803, 270.307, 192.415, 83.197, 144.007, 308.176, 78.997, 239.135, 375.310, 206.123, 158.092, 284.579, 332.541, 217.623, 140.984, 380.928, 191.493, 154.945, 115.988, 62.142, 249.890, 326.027, 191.101, 130.113, 197.894, 206.230, 152.111, 254.233, 181.729, 81.355, 123.275, 326.409, 172.203, 374.163, 287.383, 114.317, 184.655, 323.417, 287.767, 110.775, 99.986, 181.331, 338.271, 228.368, 316.669, 232.740, 271.724, 117.512, 275.828, 274.498, 231.248, 159.472, 201.982, 316.621, 112.098, 178.600, 123.809, 400.580, 222.534, 281.254, 125.720, 90.129, 187.656, 221.610, 114.526, 235.235, 184.599, 130.540, 189.228, 186.493, 353.292, 337.636, 133.346, 190.405, 181.534, 212.442, 146.141, 307.794, 218.844, 239.881, 95.071, 208.655, 154.344, 114.755, 118.231, 189.640, 184.900, 178.869, 177.318, 59.868, 254.241, 380.804, 205.745, 125.918, 243.410, 198.363, 128.927, 230.730, 266.939, 271.722, 269.754, 247.343, 74.356, 202.437, 397.285, 325.388, 67.354, 391.150, 288.170, 418.194, 147.019, 179.759, 137.454, 137.062, 351.960, 108.040, 150.711, 294.880, 76.548, 123.025, 192.853, 240.710, 117.890, 370.161, 267.097, 416.685, 218.959, 231.381, 284.618, 228.630, 161.664, 223.340, 145.249, 227.753, 266.489, 188.144, 181.757, 274.724, 316.374, 203.706, 159.799, 342.731, 185.596, 187.307, 402.489, 220.397, 150.720, 210.655, 214.031, 199.986, 183.795, 311.265, 178.262, 266.808, 250.113, 149.706, 204.173, 188.556, 187.998, 354.099, 243.388, 123.037, 275.185, 248.058, 113.351, 187.241, 331.741, 127.721, 227.990, 198.601, 416.147, 235.724, 233.383, 223.127, 105.698, 205.371, 182.125, 344.766, 359.947, 62.130, 354.087, 214.007, 209.992, 213.920, 87.754, 304.301, 228.259, 102.740, 313.572, 211.680, 175.989, 113.088, 145.204, 295.877, 287.990, 200.007, 277.213, 273.718, 89.085, 194.352, 115.507, 245.579, 239.680, 174.793, 276.977, 134.727, 240.856, 291.949, 139.573, 91.741, 317.497, 235.767, 240.129, 302.844, 189.517, 307.940, 323.717, 165.851, 203.844, 71.209, 251.033, 336.319, 82.078, 94.485, 226.021, 123.321, 142.639, 83.828, 138.352, 66.444, 191.156, 97.702, 251.331, 104.169, 158.102, 185.686, 331.206, 402.935, 115.408, 188.277, 221.885, 206.885, 248.667, 152.676, 379.280, 203.254, 189.983, 168.028, 203.843, 263.648, 341.312, 175.453, 164.369, 367.515, 173.858, 362.733, 370.787, 231.901, 325.665, 301.761, 391.046, 69.993, 225.791, 283.357, 398.080, 222.124, 232.843, 208.276, 246.563, 333.502, 278.736, 187.289, 228.657, 252.700, 331.656, 242.210, 297.471, 231.363, 282.751, 364.051, 337.505, 318.595, 200.463, 359.154, 137.293, 279.504, 185.709, 118.838, 202.421, 263.317, 60.744, 167.808, 326.019, 357.045, 113.559, 271.477, 409.130, 279.601, 134.820, 62.657, 219.640, 82.362, 278.756, 372.210, 130.543, 397.346, 335.728, 127.946, 186.227, 214.589, 158.485, 166.354, 189.890, 264.383, 61.094, 218.088, 294.370, 240.681, 362.489, 171.134, 242.499, 283.925, 270.886, 194.488, 249.766, 350.116, 101.200, 64.988, 238.758, 174.488, 303.396, 99.506, 197.443]
    plt.hist(test, bins=500)
    plt.show()
    # plot_chains()
    # plot_chain_sum()







